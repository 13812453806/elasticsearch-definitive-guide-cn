#动态索引

下一个需要解决的问题是如何在保持不可变好处的同时更新反向索引。答案是，使用多个索引。

不是重写整个反向索引，而是增加额外的索引(indices)反映最近的变化。每个反向索引都可以按顺序查询，从最老的开始，最后把结果聚合。

Elasticsearch底层依赖的Lucene，引入了per-segment search的理念。一个段(segment)是有完整功能的反向索引，但是现在Lucene中的索引指的是段的集合，再加上提交点(commit point，包括所有段的文件)。新的文档，在被写入磁盘的段之前，首先写入内存区的索引缓存。
